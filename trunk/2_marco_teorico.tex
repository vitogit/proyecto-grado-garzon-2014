\chapter{Marco Teórico}

 En este capitulo se aborda el marco teorico necesario para comprender mas facilmente el desarrollo de los capitulos posteriores. Se analiza el problema del trafico en general, los simuladores y los algoritmos a utilizar.

\section{Planificación del trafico}
\subsection{Problematica} 
\subsection{Corredor Garzon}
El corredor Garzon esta ubicado en Montevieo Uruguay, fue construido como parte de un plan de movilidad que incluye otros 4 corredores. 
Presenta un carril exclusivo para ombnibus y preferenciales
http://www.montevideo.gub.uy/ciudadania/stm-transporte-metropolitano/plan-de-movilidad/corredores

Tiene 6km de largo , extendiendose desde ...  hasta ..
%http://www.montevideo.gub.uy/sites/default/files/articulo/corredor_garzon.pdf

Agregar mapa

Los problemas de sincronizacion de semaforos fueron admitidos en varias publicaciones.

18 diciembre 2013 - Corredor Garzon lucha contra el tiempo %http://www.elpais.com.uy/informacion/imm-corredor-garzon-tiempos-cambios.html
Dice que antes de GArzon se demoraba promedio 18 minutos, y al inaugurar el corredor 30 minutos. Despues se mejoro algo para equilibrar los tiempos
Para el jerarca, eso se dio "con la diferencia de que hoy hay 15 semáforos más y se ganó en seguridad". En concreto, tras la obra, se pasó de tener 5 semáforos a 20. Según Campal, su descoordinación inicial, entre otros aspectos, fue lo que provocó tales demoras, generando malestar en los usuarios.
invesrion de 60 millones


4 agosto 2013 - Garzon desde un omnibus %http://www.elpais.com.uy/informacion/corredor-garzon-visto-bus.html


30 julio 2013  - Intendetnta admite errores %http://www.elpais.com.uy/informacion/garzon-olivera-admitio-errores.html
La intendenta admte errores y dice: no se ha logrado sincronizar los semáforos. Hay un tema con el software,(y) la empresa subcontratada no ha dado los resultados esperados


Abril 2013 - Otro Corredor con obras paralizadas por criticas a GArzon
%http://www.elpais.com.uy/informacion/marcha-atras-en-corredor-agraciada.html





\section{Algoritmos Evolutivos}
Los algoritmos evolutivos son métodos no deterministicos que se inspiran en la evolución natural de las especies utilizando conceptos como población, cruzamiento, mutación, selección, etc. Estos se utilizan para resolver problemas de optimizacion y búsqueda, entre otros. []

Es una tecnica iterativa que busca en cada paso mejorar las soluciones por medio de operadores y basado en un criterio predefinido de maximizacion o minimizacion.

Este tipo de solución a demostrado su utilidad en una amplia variedad de problemas complejos.


\subsection{Algoritmos Geneticos}
Un algoritmo genético es un tipo de algoritmo evolutivo, siendo de los mas populares.

La idea base es que partiendo de una población inicial de individuos se seleccionan los mejores en base a su aptitud respecto a solucionar el problema y estos se utilizan para generar nuevos individuos ya sea por combinacion o modificacion. Por tanto en cada paso obtenemos mejores soluciones hasta detenernos usando un criterio de parada ya sea el numero de iteraciones o cuando ya no se puede mejorar mas la solucion.

Un individuo es una codificación de la solución que resuelve el problema.
La población inicial puede generarse aleatoriamente o basándose en algún conocimiento previo.
La función de evaluación indica que tan buena o apta es una solución en comparación con las demás.
En cada iteracion la cual se llama generación se aplican operadores de cruzamiento estos son formas de combinar a los individuos para obtener otros que potencialmente sean una mejor solución y también cambios aleatorios sobre los individuos llamado mutación.

Por tanto se van seleccionando, combinando y cambiando las mejores soluciones en un proceso que va obteniendo mejores soluciones.
El criterio de parada nos indica cuando termina este proceso, ya sea por que se alcanzo un numero de generaciones predefinidos o por que la mejora no es tan evidente. Al final se devuelve la mejor solución encontrada en todo el proceso.


Hay que indicar que no es una técnica exacta pero si logra muy buenas aproximaciones y es muy buena en problemas complejos por su flexibilidad y robustez. 


\subsubsection{Representacion de soluciones}
No podemos trabajar directamente sobre las soluciones, por lo que tenemos que codificarlas en un modelo que nos sirva para poder aplicar el algoritmo.
La inspiracion biologica se ve en los nombres que adopta esta representacion, llamada Cromosoma que es un vector de genes y cada valor de un gen se llama alelo.
En general se codifica un vector de numeros binarios o reales de largo fijo, lo que facilita la aplicacion de los operadores.

\subsubsection{Función de Evaluación:} 
Indica que tan bueno es un individuo para resolver el problema en cuestion con un valor conocido como Fitness. Este se utiliza para seleccionar a los mejores y de esta forma guiar la exploracion hacia la mejor solucion.
Se deben tener en cuenta las reestricciones del problema para que las soluciones no factibles no sobrevivan.
En general es donde se consume el mayor tiempo del algoritmo en comparacion con los demas operadores.

\subsubsection{Operador de Seleccion}
Existen diversos operadores de seleccion , su funcion es que las mejores caracteristicas de los individuos se mantentan en las siguentes generaciones.
Ruleta:
Torneo:
Elitismo:

\subsubsection{Operador de Cruzamiento}
Su funcion es combinar individuos para lograr mejores soluciones. 
Existe una taza que se puede modificar para indicar la probabilidad de que se realice el cruzamiento.
Cruzamiento de un punto:
Cruzamiento azar

\subsubsection{Operador de Mutacion}


\subsubsection{Mutacion:} 
Indica el metodo utilizado para modificar un individuo, esto se realiza para lograr mas diversidad y no caer en maximos locales. En general aplica una modificacion aleatoria en el cromosoma.
Tambien hay una taza de probabilidad, en general es baja.

\subsubsection{Reemplazo} 
Se indica cual es el criterio que debemos tomar para crear una nueva poblacion, ya sea tomando solo los nuevo hijos creados, comparando tambien con los padres o aplicando algun otro criterio.

\subsubsection{Criterio de parada:} 
Indica cuando debe terminar el algoritmo, puede ser definiendo un numero fijo de generaciones o analizando si la mejora en soluciones se estanco.

\subsection{Algoritmos Genetico Simple (AGS)}

El algoritmo que vamos a utilizar es el simple, propuesto por Godber [] 
El operador principal es el de cruzamiento y el secundario la mutación.

Su esquema de funcionamiento es el siguiente


\begin{algorithm}%[!ht]
	\caption{Algoritmo Genético Simple}
	\label{alg:algoritmo_genetico_simple}
	\begin{algorithmic} [1] 
		{
			%\small
			\STATE {Inicializo( Pob(0))}
			\STATE \texttt{generacion} = 0
			\WHILE {\text{No llegue al criterio de parada}}
			\STATE {Evaluar Pob(generacion)}
			\STATE {Padres = Seleccionar(Pob(generacion))}
			\STATE {Hijos = Cruzamiento(Padres) y Mutacion(Padres)}
			\STATE {NuevaPob = Reemplazar Pob(generacion) con Hijos}
			\STATE \texttt{generacion}++
			\ENDWHILE
			\RETURN Mejor solución
		}
	\end{algorithmic}
\end{algorithm}




\subsection{Algoritmos Genetico Multi-objectivo}
En este caso se busca una solucion que satisfaga de forma simultanea las reestricciones y varios objetivos diferentes.

\subsection{Algoritmo Genetico Paralelo}
\subsection{Maestro-Esclavo}
\subsection{Resumen}




\section{Simulación y herramientas}
\subsection{Simuladores de trafico}
Los simuladores de trafico son programas que simulan el movimiento de vehiculos sobre una red de calles,es una herramienta muy usada en la investigacion de trafico vehicular, asi como estudio de congestiones o analisis de impacto que tendran nuevas infraestructuras.  Las razones para usar una simulacion son varias, entre ellas se encuentra  la rapidez  ya que la simulacion se puede realizar en tiempo mucho mas rapidos que en la realidad, el costo en dinero ya que no estamos afectando el escenario real  y tampoco tenemos que modificar o detener el escenario real para probar nuevos parametros. ADemas nos sirve para poder preever situaciones que podrian darse bajo determinadas circunstancias.

Los simuladore se puedne dividir en microscopicos o macroscopicos según el nivel de detalle de la simulacion. Un simulador macroscopico modela  el trafico vehciular como un fluido. En cambio un simulador microscopico simula el movimiento de cada vehiculo según sus caracteristicas particulares.
SUMO es uno de los simuladores abiertos mas populares,  es microscopico aunque presenta algunas dificultades a la hora de la configuracion del mapa y el transito que lo hace en base a arhivos XML.

Cuanto mas crece el numero de vehiculos y la complejidad de la red de mapas mas dificil se hace crear la entrada basica que necesita el simulador. Aunque existen diversas herramientas que ayudan a este proceso aun se requiere un trabajo manual para el acondicionado de estos archivos.
SUMO simula el trafico utilizando archivos XML que representan las rutas, los vehiculos y el trafico. En 

\subsection{Modelo de trafico }
Esta es la representacion de la circulacion de vehiculos, exiten varios metdos desde 
Aleatorios: Genera diferentes recorridos que seguiran los vehiculos aleatoriamente
JTR : basados en probablidaddes en los cruces  es decir cuando un vehciulo llega a un cruce tiene cierta probabilidad de seguir o doblar (JTR – junction turning ratio), 
Basado en discritctos:  Se especifican districtos(conjunto de calles) y  la cantidad de movimiento vechiular entre ellos en una  matriz
Basado en Actividad: Se especifica la cantidad de casas , vehiculos y poblacion en un determinado lugar y el modelo genera la densidad de trafico que se producira basado en los tipos de actividades que se realizan comunment como ir al trabajo, hacer las compras, ir a la escuela,  etc
Definido por el usuario: que permiten determinar la ruta de los vehiculos con mayor detalle.

\subsection{Representaciones}

\subsubsection{Red calles}
La red de calles se representa como un grafico dirigido en un archivo xml con extension .net.xml . Alli se especifican los nodos, y vertices asi como sus atributos. Tambien se representan los semaforos. Esto  se genera utilizando una herramienta  para convertir un mapa al formato que SUMO utiliza.

\subsubsection{Representacion Trafico}
En este caso tambien se tuliza un arhicvo xml donde se definen las rutas y los trips. Un trip representa el movimiento de un vehiculo de un punto inicial hacia un punto final (El recorrido se hacen en tiempo de ejecucion utilizando el camino mas corto basado en el trafico). Una ruta es mas complejo que un trip ya que agrega todos los vertices por los que el vehiculo pasara.

SUMO tambien soporta el modelo JTR y basado en discritctos pero se necesitan modulos externos para generarlos.

\subsubsection{Representacion del tiempo}
El tiempo se representa como una serie de pasos discretos, cada uno durando un segundo. Este valor se puede modifcar aunque es recomendado dejarlo asi para que sea concistente


\subsection{Ajustes de archivos de SUMO}
Pasos y problemas en la generacion y adecuacion del mapa

\subsection{Trafico}
Elegimos utilizar el flow calle-a-calle que nos permite determinar con mucho detalle el trafico generado entre calles. Ya que contamos con datos relevados en el lugar. Se especifica el lugar de donde sale el vehiculo, donde termina su recorrido, el numero de vehiculos que se emiten o la frecuencia.

\subsubsection{Tipos de vehiculos}
Se pueden crear diferentes tipos de vehiculos especificando propiedades como largo, velcoidad maxima,  aceleracion, color, etc. TAmbien contamos con algunos por defecto como camiones, buses

\subsubsection{Accidentes}
El simulador permite representar colisiones y el corte de una calle. Decidimos no utilizar esto pues no queriamos este tipo de variables afectara en la ejecucion de las pruebas.

\subsection{Trabajo de campo realizado}
Al no contact con datos publicos sobre la configuracion de los semaforos de la zona, realizamos un relevamiento in situ de la siguente forma.
En los principales cruces realizamos una filmacion de 30 min. Luego analizamos el video realizando el conteo manualmente con la posiblidad de enlenter el video para mayor facilidad.
Estas medidas nos sirvieron para verificar nuestros modelos basados en los datos del GPS 

La configuracion de los semaforos se realizo yendo por el corredor y cronometrando la duracion del tiempo. Tanto en ida como en venida para coproborar que fueran correctos.



\subsection{Configuración de la simulación}

\subsubsection{Diseño del mapa}
El mapa base de la zona lo tomamos de OSM, luego se cotejo su exactitud con Google Maps y Bing Maps.
Utilizamos la herramienta netconvert para pasarlo a formato que SUMO acepte. 
Para esto realizamos varios ajustes editando los archivos xml para indicar donde se realizan.

Se generó una especial dificultad en el diseño de un mapa que
fuese tan fiel como fuese posible a la realidad y que también
fuese compatible para usar con  Sumo. Se debió recabar datos
in  situ  ya  que  hasta  la  misma  intendencia  [4]  tenía  errores
respecto a la realidad, falta de algunos semáforos, etc. Luego al
pasarlo  al  formato  compatible  con  sumo  se  debieron  corregir
calles,  cruces  y  todas las  posibles  conexiones de  las  esquinas
del corredor que debieron ser escritas a mano en un XML.

Poner fotos de un ants (salida directa del netconverte) y luego con los agregados de joins y connections


\subsubsection{Vehículos}
Se manejaron dos tipos de vehículos, autos y ómnibus:
Las  líneas  de  ómnibus  urbanas  (que  circulan  por  el
corredor)  incluidas  fueron  la  “G”,  la  “409”  y
adaptaciones  de  la  “522”  y  “148”  que  se  juntaron  en
una  línea  sola. Y  las líneas de ómnibus suburbanas en
el  tramo  elegido  realizan  el  mismo  trayecto  y  les
llamamos  línea  “A".  Todas  las  líneas  de  ómnibus
fueron cargadas con las paradas correspondientes y se
hicieron  variantes  en  los  viajes  dentro  de  una  misma
línea de manera que no siempre paran en los mismos
lugares.
Los  viajes  de  los  autos  son  generados  aleatoriamente
de modo que no circulen por el corredor (que es para
los  ómnibus  urbanos)  y  de  forma  que  tengan  mayor
probabilidad los viajes que comienzan y terminan en el
borde  de  la  red,  luego  se  seleccionan  los  viajes  de
manera  que  las  grandes  avenidas  sean  más  recorridas
que  las  calles  menos  importantes.

\subsubsection{Semáforos en cada cruce}
Se  tomaron  los  tiempos  de  cada  luz  de  los  semáforos  en
cada  cruce  y  luego  estos  datos  fueron  cargados  al  simulador
para comparar con los  resultados  así como también para base
de nuestro algoritmo evolutivo.
\subsubsection{Escenarios}


\section{Resumen}

